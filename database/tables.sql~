/*TABELLE DEL DB */

/*
tabella che contiene i dati di una persona
il campo ruolo indica il ruolo svolto dall persona nel sistema:
-C: cuoco
-I: impiegato
-A: amministratore
*/
CREATE TABLE IF NOT EXISTS `PERSONA` (
  `MATRICOLA` int NOT NULL AUTO_INCREMENT,
  `PASSWORD` varchar(25) NOT NULL,
  `NOME` varchar(25) NOT NULL,
  `COGNOME` varchar(25) NOT NULL, 
  `DATA_NASCITA` DATE NOT NULL,
  `RUOLO` char(1) NOT NULL,
  PRIMARY KEY (`MATRICOLA`)
) ENGINE=InnoDB DEFAULT CHARSET=latin1;


CREATE TRIGGER Chk_Persona_Ruolo ON magna_tron_db.PERSONA
AFTER INSERT, UPDATE
AS
IF EXISTS (SELECT *
           FROM NEW n
           WHERE n.RUOLO not in ('C','I','A')   
      )
BEGIN
    RAISERROR ('RUOLO NON CORRETTO', 16, 1);
    ROLLBACK TRANSACTION;

    RETURN 
END;


INSERT INTO PERSONA (PASSWORD,NOME,COGNOME,DATA_NASCITA,RUOLO) 
              VALUES('secure123','mario','rossi','2005-05-22','c');

INSERT INTO PERSONA (PASSWORD,NOME,COGNOME,DATA_NASCITA,RUOLO) 
              VALUES('secure123','mario','SBAGLIATO','2005-05-22','B');



